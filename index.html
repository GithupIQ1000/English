<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ghi dữ liệu vào GitHub</title>
</head>
<body>
  <h2>Lưu dữ liệu JSON lên GitHub</h2>
  <input id="name" placeholder="Nhập tên">
  <input id="score" placeholder="Nhập điểm">
  <button onclick="saveData()">Lưu</button>

  <pre id="result"></pre>

  <script>
    async function saveData() {
      const user = "GithupIQ1000";
      const repo = "TenRepository";
      const path = "data.json"; // tên file trong repo
      const token = "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"; // Dán token vào đây

      // Dữ liệu muốn lưu
      const newData = {
        name: document.getElementById("name").value,
        score: document.getElementById("score").value
      };

      // 1️⃣ Lấy SHA của file hiện có (để cập nhật)
      const res = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`, {
        headers: { Authorization: `token ${token}` }
      });
      const json = await res.json();

      // 2️⃣ Gộp dữ liệu mới với dữ liệu cũ (nếu có)
      let oldData = [];
      if (json.content) {
        oldData = JSON.parse(atob(json.content));
      }
      oldData.push(newData);

      // 3️⃣ Ghi lại file
      const update = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Cập nhật dữ liệu từ web",
          content: btoa(JSON.stringify(oldData, null, 2)),
          sha: json.sha
        })
      });

      const result = await update.json();
      document.getElementById("result").textContent = JSON.stringify(result, null, 2);
    }
  </script>
</body>
</html>
